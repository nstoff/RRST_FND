---
title: "RRST - analysis CH with N=92"
author: "Natascha Stoffel"
date: "`r date()`"
format:
  html:
    embed-resources: true
    toc: true #to show table of contents
editor: visual
---

## Data and Preparation

Respiratory Interoception; multicenter study

Analysis of participants of site CH from 15.10.23 until 10.09.2024;

```{r}
#| output: false
#| warning: FALSE
#| error: FALSE

# remove everything that we stored in the environment
rm(list=ls()) 

# Load necessary libraries
library(readr)
library(dplyr)
library(rstatix)
library(gtsummary)
library(ggplot2)
library(ggpubr)
library(openxlsx)
library(gt)
library(stats)
library(grDevices)

# load prepared and cleaned file from 00_preparation: Data.RRST_FINAL_yyyymmdd.csv
setwd("/Users/nataschastoffel/Documents/GitHub/interoception_NS")
df_RRST <- read_csv("/Users/nataschastoffel/Documents/GitHub/interoception_NS/data/processed/09-2024/Data.RRST_FINAL_20240919.csv")
df <-df_RRST[-c(1)] # remove additional column 

excluded_pcodes <- c()  # in case there are pcodes that I want to exclude; TO BE DEFINED
# Filter out the rows with the specified pcodes
df <- df %>% filter(!pcode %in% excluded_pcodes)

# prepare variables
df$group <- as.factor(df$group)
df$sex <- as.factor(df$sex)
df$medication <- as.factor(df$medication)

df$age <- as.numeric(df$age)
df$bdi <- as.numeric(df$bdi)
df$stai_s <- as.numeric(df$stai_s)
df$stai_t <- as.numeric(df$stai_t)
df$maia_total <- as.numeric(df$maia_total)
df$sdq <- as.numeric(df$sdq)
df$ctq_total <- as.numeric(df$ctq_total)
df$ias <- as.numeric(df$ias)
df$rrst_sensitivity <- as.numeric(df$rrst_sensitivity)
df$traitPE_maiaRRST <- as.numeric(df$traitPE_maiaRRST)
df$traitPE_iasRRST <- as.numeric(df$traitPE_iasRRST)
df$metascore <- as.numeric(df$metascore)
df$bmi <- as.numeric(df$bmi)

# define required subgroups
df_female <- df[df$sex == "1", ]
df_male <- df[df$sex == "2", ]

df_HC <- df[df$group == "0", ]
df_FND <- df[df$group == "1", ]

# overview across group and sex distribution
tbl <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("male", "female"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND")))
tbl1<-table(tbl$group,tbl$sex)

tbl1
capture.output(tbl1, file = "01_Table_Sex-Group.txt")

# overview for mean age across group
df%>%
  group_by(group) %>%
  get_summary_stats(age, type = "mean_sd")
res<-t.test(df$age[df$group == "0"], df$age[df$group == "1"]) # 
res # no sig difference between the groups in age
capture.output(res, file = "02_T-Test_Age.txt")
```

Having prepared everything we need to look at the distribution of the data, so we choose the adequate statistical tests

```{r}
#| output: false
#| warning: FALSE
#| error: FALSE
# Testing for distribution across and within each group, per variable that is of interest for us 
shapiro.test(df$rrst_sensitivity) #  normally distributed

shapiro.test(df$metascore)#  normally distributed
shapiro.test(df$metascore[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$metascore[df$group == "0"]) # controls within themselves are normally distributed

shapiro.test(df$age) # NOT normally distributed
shapiro.test(df$age[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$age[df$group == "0"]) # controls within themselves are normally distributed
df$sex <- as.numeric(df$sex)
shapiro.test(df$sex) # NOT normally distributed
shapiro.test(df$sex[df$group == "1"]) # patients within themselves are NOT normally distributed
shapiro.test(df$sex[df$group == "0"]) # controls within themselves are NOT normally distributed


shapiro.test(df$bdi) #  NOT normally distributed : p < 0.05
shapiro.test(df$bdi[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$bdi[df$group == "0"]) # controls within themselves are NOT normally distributed

shapiro.test(df$stai_t) #  normally distributed 

shapiro.test(df$stai_s) #  NOT normally distributed 
shapiro.test(df$stai_s[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$stai_s[df$group == "0"]) # controls within themselves are NOT normally distributed : p < 0.05

shapiro.test(df$ctq_total) #  NOT normally distributed : p < 0.05
shapiro.test(df$ctq_total[df$group == "1"]) # patients within themselves are also NOT normally distributed
shapiro.test(df$ctq_total[df$group == "0"]) # controls within themselves are also NOT normally distributed

shapiro.test(df$sdq) #  NOT normally distributed : p < 0.05
shapiro.test(df$sdq[df$group == "1"]) # patients within themselves are NOT normally distributed
shapiro.test(df$sdq[df$group == "0"]) # controls within themselves are NOT normally distributed : p < 0.05

shapiro.test(df$maia_total) # normally distributed 
shapiro.test(df$traitPE_maiaRRST) # NOT normally distributed with p < 0.05
shapiro.test(df$traitPE_maiaRRST[df$group == "1"]) # within patients trait PE is NOT normally distributed with p < 0.05
shapiro.test(df$traitPE_maiaRRST[df$group == "0"]) # within controlstrait PE is NOT normally distributed with p < 0.05

shapiro.test(df$ias) # NOT normally distributed 
shapiro.test(df$traitPE_iasRRST) # NOT normally distributed with p < 0.05
shapiro.test(df$traitPE_iasRRST[df$group == "1"]) # within patients trait PE  is NOT normally distributed with p < 0.05
shapiro.test(df$traitPE_iasRRST[df$group == "0"]) # within controls trait PE  is NOT normally distributed with p < 0.0


shapiro.test(df$bmi) # NOT normally distributed with p < 0.05
shapiro.test(df$bmi[df$group == "1"]) # within patients bmi is normally distributed 
shapiro.test(df$bmi[df$group == "0"]) # within control bmi is NOT normally distributed with p < 0.05
```

## Testing Group Differences

```{r}
#| output: false
#| warning: FALSE
#| error: FALSE
#| 
# parametric t-test for NORMALLY distributed data
res<-t.test(df$stai_t[df$group=="1"], df$stai_t[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-t.test(df$maia_total[df$group=="1"], df$maia_total[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-t.test(df$rrst_sensitivity[df$group=="1"], df$rrst_sensitivity[df$group=="0"])
res # no sig difference between groups


# non paramatric wilcox test for NOT normally distributed data 
res<-wilcox.test(df$metascore[df$group=="1"], df$metascore[df$group=="0"])
res # no sig difference between groups
res<-wilcox.test(df$ias[df$group=="1"], df$ias[df$group=="0"])
res # no sig difference between groups
res<-wilcox.test(df$bdi[df$group=="1"], df$bdi[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$stai_s[df$group=="1"], df$stai_s[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$ctq_total[df$group=="1"], df$ctq_total[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$sdq[df$group=="1"], df$sdq[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$ias[df$group=="1"], df$ias[df$group=="0"])
res # no sig difference between groups
res<-wilcox.test(df$traitPE_iasRRST[df$group=="1"], df$traitPE_iasRRST[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$traitPE_maiaRRST[df$group=="1"], df$traitPE_maiaRRST[df$group=="0"])
res # only trend 
res<-wilcox.test(df$bmi[df$group=="1"], df$bmi[df$group=="0"])
res # only trend 

```

# Summary Table (Overview of Demographics)

```{r}
#| warning: FALSE
#| error: FALSE
# SUMMARY table
df$sex <- as.factor(df$sex)

df_tbl <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("male", "female"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND")))

df$sex <- as.factor(df$sex)

df_tbl <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("male", "female"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND")))

Data.t <- select(df_tbl, c("group", "sex", "age", "medication", "bmi", "bdi", "stai_t", "stai_s", "ctq_total", "sdq",
                           "maia_total","traitPE_maiaRRST", "ias", "traitPE_iasRRST", "rrst_sensitivity", "metascore" ))
library(gtsummary)
tbl1 <- Data.t %>%
  tbl_summary(
    by = group,
    missing = "no",
    statistic = list(
      age = "{mean} ({sd})",
      sex = "{n} ({p})",
      medication ="{n} ({p})",
      bmi = "{mean} ({sd})",
      bdi = "{mean} ({sd})",
      stai_t = "{mean} ({sd})",
      stai_s = "{mean} ({sd})",
      ctq_total = "{mean} ({sd})",
      sdq = "{mean} ({sd})",
      maia_total = "{mean} ({sd})",
      traitPE_maiaRRST = "{mean} ({sd})",
      ias = "{mean} ({sd})",
      traitPE_iasRRST = "{mean} ({sd})",
      rrst_sensitivity = "{mean} ({sd})",
      metascore = "{mean} ({sd})"
    ),
    digits = list(age = 1, sex = 1, medication = 1, bdi = 1, stai_t = 1, stai_s = 1, ctq_total = 1, sdq = 1, 
                  maia_total = 1 ,traitPE_maiaRRST = 1, ias = 1, traitPE_iasRRST = 1, rrst_sensitivity = 3, metascore = 3),
    label = list(age = "Age",
                 sex = "Sex",
                 medication = "Intake of Medication (yes)",
                 bmi = "Body Mass Index (kg/mÂ²)",
                 bdi = "Depressive Symptoms (BDI-II)",
                 stai_t= "Anxiety Trait (STAI-T)",
                 stai_s= "Anxiety State (STAI-S)",
                 ctq_total= "Childhood Trauma (CTQ)",
                 sdq= "Dissociative Symptoms (SDQ-20)",
                 maia_total= "Interoceptive Awareness Self-Report (MAIA)",
                 traitPE_maiaRRST= "Trait-Prediction-Error (MAIA-RRST)",
                 ias= "Interoceptive Accuracy Self-Report (IAS)",
                 traitPE_iasRRST = "Trait-Prediction-Error (IAS-RRST)",
                 rrst_sensitivity= "Respiration Sensitivity (RRST)",
                 metascore= "Metacognition Score (RRST)")
  ) %>%
  modify_header(list(label ~ "**Variable**")) %>%
  modify_caption("**Interoception Overview**") %>%
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Group**") %>%
  add_p(test = list(stai_t = "t.test", 
                    maia_total = "t.test", 
                    rrst_sensitivity = "t.test", 
                    metascore = "t.test", 
                    everything() ~ "wilcox.test")) %>%  # Use wilcox test for all except specified variables
  add_overall(last = FALSE) %>%
  modify_footnote(
    # Adding footnote specifying the test used for each variable
    all_stat_cols() ~ "t-test was used for normally distributed data_ STAI-T, MAIA, Respiratory Sensitivity, Metacognition Score. Wilcoxon test was used for all other variables (non-normally distributed)."
  )
tbl1

```

# Visualization of Group Difference

using Violin Plot to show the distribution of the raw data as much as possible, including a point as the median

```{r}
#| warning: FALSE
#| error: FALSE
df$group <- as.factor(df$group)

plotViolinGroups <- function(df, var , tit ){plot <-ggplot(df, aes(x=group, y=var, fill=group)) + 
    geom_violin(show.legend = FALSE, width = 0.7, trim = FALSE, alpha = 0.8) + 
    stat_summary(show.legend = FALSE, fun = median, geom = "point", color = "black", size = 2) +
    labs(y = "Score") + 
    theme_classic()+ 
    scale_fill_manual(values = c("#868686FF", "#BB4038"))+ 
    scale_x_discrete(labels=c("Controls", "Patients"))+  
    guides(fill=guide_legend(title="Timepoint"))+ 
    ggtitle(tit) +
    xlab("")
  
  return(plot)}

p1 <- plotViolinGroups(df,df$bdi,"BDI - Depression")+ ggpubr::stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p1


p2 <- plotViolinGroups(df,df$stai_s,"STAI - State Anxiety")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)

p3 <- plotViolinGroups(df,df$stai_t,"STAI - Trait Anxiety")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)

gridExtra::grid.arrange(p2, p3, ncol = 2)


p4 <- plotViolinGroups(df,df$ctq_total,"CTQ - Childhood Trauma")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p4


p5 <- plotViolinGroups(df,df$sdq,"SDQ-20 - Dissociation")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p5


p6 <- plotViolinGroups(df,df$maia_total,"MAIA - Interoceptive Awareness")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p6


p7 <- plotViolinGroups(df,df$ias,"IAS - Interoceptive Accuracy")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p7


p8 <- plotViolinGroups(df,df$traitPE_maiaRRST,"TraitPE MAIA-RRST")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)

p9 <- plotViolinGroups(df,df$traitPE_iasRRST,"TraitPE IAS-RRST")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)

gridExtra::grid.arrange(p8, p9, ncol = 2)

p10 <- plotViolinGroups(df,df$rrst_sensitivity,"Respiratory Sensitivity")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)

p11 <- plotViolinGroups(df,df$metascore,"Respiratory Metacognition")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
gridExtra::grid.arrange(p10, p11, ncol = 2)

```

# Predicting Group

```{r}
#| warning: FALSE
#| error: FALSE
df$group <- factor(df$group)

# predicting group using logistic regression with variables of interst
glm1 <- glm(formula = group ~ sex + age + medication + bdi + stai_s + stai_t + ctq_total + ias + maia_total + sdq,
            data = df,
            family = binomial) # as group has two levels
summary(glm1) # SDQ, BDI and STAI_T sig predictor of GROUP

# predicting group using logistic regression with variables of interst
glm2 <- glm(formula = group ~  rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore ,
          data = df,
          family = binomial) # as group has two levels
summary(glm2) # RRST senstivity sig predicts group


glm3 <- glm(formula = group ~ sex + age + medication + bdi + stai_s + stai_t + ctq_total + ias + maia_total + sdq + rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore + menopause + contraception,
            data = df,
            family = binomial) # as group has two levels
summary(glm3) # SDQ as sig predictor of GROUP, while trend for stai_t and bdi
# Check Variance Inflation Factor (VIF) for multicollinearity: High VIF values (typically above 5 or 10) indicate problematic multicollinearity.
# vif(glm3) # no promlematic multicollinearity (all below 3)
```

# Predicting Symptom Severity in FND

```{r}
#| warning: FALSE
#| error: FALSE
#SFMDRS
summary(df_FND$sfmdrs) # summary of symptom severity

sfmdrslm <- lm(formula = sfmdrs ~  rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore + bdi + stai_s + stai_t + sdq + ctq_total,
               data = df_FND) 
summary(sfmdrslm)   # rrst_sensitivity and stai_s predicting sfmdrs

#CGI
summary(df_FND$cgi) # summary of symptom severity
df_FND$cgi # list of different values
cgilm <- lm(formula = cgi ~   rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore +  bdi + stai_s + stai_t + sdq + ctq_total,
            data = df_FND) 
summary(cgilm) # rrst sensitivity, traitPE-maia and bdi sig predictor of CGI

```

# Predicting Respiratory Sensitivity (RRST)

```{r}
#| warning: FALSE
#| error: FALSE
# Without covariates; difference of RRST depending on group as a simple linear regression
RRSTlm <- lm(formula = rrst_sensitivity ~ group,
             data = df) 

summary(RRSTlm) # no sig diff across groups (pvalue > 0.05

## Extended Linear model: including covariates and running an ANOVA on the fitted model/data
# by including these variables I am assessing the relationships of group and rrst_sensitivty INDEPENDENT of the differences in the variables I added here as covariates
RRSTlm <- lm(formula = rrst_sensitivity ~ group + sex + age + medication + bmi + stai_s + stai_t + ctq_total + ias + maia_total + sdq,
             data = df) 

summary(RRSTlm) # sex and sdq as sig predictor of RRST
RRSTAov <- aov(RRSTlm) # running an ANOVA will test the overall significance of the model including all variables (lm: evaluates each predictor's effect on rrst_sensitivity, ANOVA gives significance test for the overall variance explained by the model)
summary(RRSTAov) #  only sdq is now significant
summary_RRSTAov<-summary(RRSTAov) 

```

# Predicting Metascore (RRST)

```{r}
#| warning: FALSE
#| error: FALSE
# Without covariates; difference of RRST metacognition depending on group
metascorelm <- lm(formula = metascore ~ group,
             data = df) 

summary_metascorelm<- summary(metascorelm) # no sig diff across groups
summary_metascorelm

## ANOVA on the fitted model/data
# We run a repeated measures Anova on the fitted data. So first a glm, then an Anova on the glm data in order to have covariates included. 
metascorelm <- lm(formula = metascore ~ group  + sex + age + medication + bmi + stai_s + stai_t + ctq_total + ias + maia_total + sdq + rrst_sensitivity,
             data = df) 

summary(metascorelm) # sig effect group and sdq of metacognition 
metascoreAov <- aov(metascorelm) 
summary(metascoreAov) #  sig effect of ias and sdq after correcting for covariates
summary_metascoreAov<-summary(metascoreAov)

cor(df$metascore, df$ias)
# 0.2535506; the higher the metascore the higher the IAS
cor(df$metascore, df$sdq)
# -0.293028; the higher the metascore the lower the sdq


```

### RRST and Metascore separately per group

```{r}
#| warning: FALSE
#| error: FALSE
# RRST prediction separatly per group
# respiratory sensitivity
RRST_FND_lm <- lm(formula = rrst_sensitivity ~ ctq_total + sdq + ias + maia_total + stai_s + stai_t + sex + age + medication + bmi + contraception + menopause + sfmdrs + cgi,
                  data = df_FND) 

summary(RRST_FND_lm) # bmi sig 
cor(df_FND$rrst_sensitivity, df_FND$bmi) # NEG correlation; the higher the sensitivity the lower the bmi in FND


lm_rrstHC <- lm(formula = rrst_sensitivity ~ ctq_total + ias + maia_total + sdq + stai_s + stai_t + sex + age + medication + bmi + contraception + menopause,
                data = df_HC) 
summary(lm_rrstHC) # contraception and bmi sig trend predictor of age and stai_t
summary_lm_rrst_HC <- capture.output(summary(lm_rrstHC))

cor(df_HC$rrst_sensitivity, df_HC$contraception) # neg corr; higher sensitivity correlates with NO contraception in HC
cor(df_HC$rrst_sensitivity, df_HC$bmi) # POS correlation; the higher the sensitivity the higher the bmi in HC


# metacognition
metacognition_FND_lm <- lm(formula = metascore ~ sex + age + medication + bmi + rrst_sensitivity + ctq_total + sdq + ias + maia_total + stai_s + stai_t,
                  data = df_FND) 
summary(metacognition_FND_lm) #  sdq sid predicting score

cor(df_FND$metascore, df_FND$sdq)
# neg corr; higher metacognition correlates with lwoer sdq scores

metacognition_HC_lm <- lm(formula = metascore ~ rrst_sensitivity + ctq_total + ias + maia_total + sdq + stai_s + stai_t + sex + age + medication + bmi,
                data = df_HC) 
summary(metacognition_HC_lm) # no sig predictor
```

## Trait Prediction Error (RRST sensibility and MAIA/IAS)

```{r}
#| warning: FALSE
#| error: FALSE
###  Trait Prediction Error (subjective Questionnaire Score vs Objective Task Score)

lm_traitPE <- lm(formula = traitPE_iasRRST ~ group,
                 data = df) 
summary(lm_traitPE) 

lm_traitPE <- lm(formula = traitPE_iasRRST ~ group + sex + age + medication + metascore + stai_s + stai_t + ctq_total + maia_total + sdq ,
                 data = df) 
summary(lm_traitPE)
TPE_Aov <- aov(lm_traitPE)
summary(TPE_Aov)


lm_traitPE <- lm(formula = traitPE_maiaRRST ~ group,
                 data = df) 
summary(lm_traitPE) 

lm_traitPE <- lm(formula = traitPE_maiaRRST ~ group + sex + age + medication + metascore + stai_s + stai_t + ctq_total + ias + sdq,
                 data = df) 
summary(lm_traitPE) # stai_t and sex sig predicting traitPE maia
TPE_Aov <- aov(lm_traitPE)
summary(TPE_Aov) # age and stai_t sig


## VISUALIZATION OF Trait PE (MAIA) and Anxiety Trait
STAIt_traitPE_maia <- ggplot(df, aes(x = traitPE_maiaRRST, y = stai_t, color = group)) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE, aes(group = group), show.legend = TRUE) +  # Separate regression lines and SE for each group
  labs(x = "Trait Prediction Error (MAIA-RRST)", y = "Anxiety Trait (STAI)", title = "Trait-Prediction Error and Anxiety Trait across Group") +
  scale_color_manual(values = c("0" = "#868686FF","1" = "#E95248"), 
                     labels = c("HC", "FND"), name = "Group") +  # Custom colors and labels
  theme_minimal()

print(STAIt_traitPE_maia)


# statistics
df %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND"))) %>% #rename the variables to HC and FND to facilitate interpretation
  group_by(group) %>%
  summarise(correlation = cor(traitPE_maiaRRST, stai_t, method = "spearman")) #spearman for NOT normally distributed data (instead of pearson for normally dist)
```

## RRST Interaction with SDQ

```{r}
#| warning: FALSE
#| error: FALSE
#### EXPLORATIVE INTERACTIONS ######
RRSTlm <- lm(formula = rrst_sensitivity ~ group * sdq + sex + age + medication + bdi + bdi + ctq_total + ias + maia_total + stai_t + stai_s + metascore, data = df) 

summary(RRSTlm) # sex significant
RRSTAov <- aov(RRSTlm)
summary(RRSTAov) #  SDQ and sex sig (males have higher RRST)

## VISUALIZATION
sdq_rrst <- ggplot(df, aes(x = sdq, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Dissociation (SDQ-20)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Sensitivity and Dissociation (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("1" = "#E95248", "0" = "#868686FF"),
                     labels = c("0" = "HC", "1" = "FND")) 
# Print the plot
print(sdq_rrst)
# interesting: strong corr for FND but not HC


# metascore
RRSTlm <- lm(formula = metascore ~ group* sdq + sex + age + medication + bdi + bdi + ctq_total + ias + maia_total + stai_t + stai_s + metascore ,data = df) 

summary(RRSTlm) # group and group*sdq interaction
RRSTAov <- aov(RRSTlm)
summary(RRSTAov) # age sig
summaryRRSTAov<-summary(RRSTAov) # sdq and group*sdq interaction (HC have higher metascores)

# same for metascore
sdq_meta <- ggplot(df, aes(x = sdq, y = metascore, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Dissociation (SDQ-20)", 
       y = "Respiratory Metacognition (AUC)", 
       title = "Respiratory Metacognition and Dissociation (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("1" = "#E95248", "0" = "#868686FF"),
                     labels = c("0" = "HC", "1" = "FND")) 
# Print the plot
print(sdq_meta)

```

# Visualization of Sex and Age in FND, separated by group

```{r}
#| warning: FALSE
#| error: FALSE
## VISUALIZATION OF AGE effect in RRST
RRST_age <- ggplot(df, aes(x = age, y = rrst_sensitivity, color = group)) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE, aes(group = group), show.legend = TRUE) +  # Separate regression lines and SE for each group
  labs(x = "Age", y = "RRST Sensitivity", title = "Respiratory Interoception by Age and Group") +
  scale_color_manual(values = c("0" = "#868686FF","1" = "#E95248"), 
                     labels = c("HC", "FND"), name = "Group") +  # Custom colors and labels
  theme_minimal()
print(RRST_age)


## VISUALIZATION OF SEX effect in RRST
RRST_sex <- ggplot(df, aes(x = sex, y = rrst_sensitivity, color = group)) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE, aes(group = group), show.legend = TRUE) +  # Separate regression lines and SE for each group
  labs(x = "Age", y = "RRST Sensitivity", title = "Respiratory Interoception by Age and Group") +
  scale_color_manual(values = c("0" = "#868686FF","1" = "#E95248"), 
                     labels = c("HC", "FND"), name = "Group") +  # Custom colors and labels
  theme_minimal()
print(RRST_sex)

```

## Highlights

-   FND group is associated with higher scores in BDI, STAI-T and SDQ

-   Symptom severity in terms of SFMDRS is associated with higher STAI-S, while CGI is associated with higher BDI and TraitPE_maiaRRST

-   higher RRST sensitivity is associated with the MALE SEX and negatively associated with SDQ (when allowing a group\*sex interaction, there ist still a main effect of sex (not the interaction\*sex group), and SDQ does not remain sig)

    -   RRST sensitivity in FND only is negatively associated with BMI

    -   RRST sensitivity in HC only is positively associated with BMI and negatively with contraception

-   RRST metascore (AUC) is positively associated with AGE and negatively associated with SDQ (when allowing a group\*sex interaction, there is a main effect of GROUP (HC have higher metascore), as well as group*\**sdq interaction, along with a positive association AGE)

    -   RRST metascore (AUC) in FND only is negatively associated with SDQ

-   higher TraitPE_maiaRRST is associated with FEMALE SEX and negatively associated with STAI-T
