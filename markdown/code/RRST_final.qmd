---
title: "RRST : Analysis - sample excluding outlier"
author: "Natascha Stoffel"
date: "`r date()`"
format:
  html:
    embed-resources: true
    toc: true #to show table of contents
editor: visual
---

# 0) Data and Preparation

Respiratory Interoception; Analysis of Site Switzerland

Analysis of participants of site CH from 15.10.23 until 10.09.2024;

```{r}
#| output: false
#| warning: FALSE
#| error: FALSE

# remove everything that we stored in the environment
rm(list=ls()) 

# Load necessary libraries
library(readr)
library(dplyr)
library(rstatix)
library(gtsummary)
library(ggplot2)
library(ggpubr)
library(openxlsx)
library(gt)
library(stats)
library(grDevices)
library(car)
library(stringr)  
library(lubridate)
library(Hmisc)

### 0.0 PREPARATION -----------------------------------------------------------
# load prepared and cleaned file from 00_preparation: df_yyyymmdd.csv
setwd("/Users/nataschastoffel/Documents/GitHub/interoception_NS")
df_RRST <- read_csv("/Users/nataschastoffel/Documents/GitHub/interoception_NS/data/processed/11-2024/Data.RRST_FINAL_20241120.csv")
df <- df_RRST[-c(1)] # remove additional column 

# excluded_pcodes <- c(14)  # pcodes that we want to exclude due to our exclusion criteria (that they were not able to perform the task adequetely; due to not understanding/performing with a 0.0000 sensitivity)
# Filter out the rows with the specified pcodes
# df <- df %>% filter(!pcode %in% excluded_pcodes)

#Set path for output files; working directory to the correct folder
setwd("~/Documents/GitHub/interoception_NS/output/RRST/11-2024")

df <- df %>%
  mutate(anx_dep_SUM = stai_t + bdi)# create one variable for the trait anxiety and depression to use as one variable in the model


# factor variables
factor_variables <- c('group', 'sex', 'psychotropic_medication', 'menopause', 'contraception')
# Apply as.numeric to the selected columns
df[factor_variables] <- lapply(df[factor_variables], as.factor)

# numeric variables
numeric_variables <- c('age', 'bmi', 'bdi', 'stai_s', 'stai_t', 'maia_total', 'anx_dep_SUM',
                     'sdq', 'ctq_total', 'ias', 'rrst_sensitivity', 
                     'traitPE_maiaRRST', 'traitPE_iasRRST', 'metascore')
# Apply as.numeric to the selected columns
df[numeric_variables] <- lapply(df[numeric_variables], as.numeric)

# define required subgroups
df_female <- df[df$sex == "1", ]
df_male <- df[df$sex == "2", ]

df_HC <- df[df$group == "0", ]
df_FND <- df[df$group == "1", ]

```

## Identifying & Argueing for the Outlier to exclude

```{r}
# Testing Outlier using boxplot (standard deviation)
df %>% 
  group_by(group) %>%
  identify_outliers(rrst_sensitivity)
# one outlier identified = P063 for rrst_sensitivity 

#### Box-Plot with Jitter
plotBoxplotGroups <- function(df, var , tit ){ 
  plot <- ggplot(df, aes(x = group, y = var, fill = group)) + 
    geom_boxplot(show.legend = TRUE) + # Show legend for boxplot
    labs(y = "Score") + 
    theme_classic() + 
    scale_fill_manual(values = c("#868686FF", "#BB4038")) + 
    scale_x_discrete(labels = c("HC", "FND")) +  
    guides(fill = "none") + # Remove the legend
    ggtitle(tit) +
    xlab("") +
    geom_jitter(shape = 16, position = position_jitter(0.2))
  
  return(plot)
}

p1 <- plotBoxplotGroups(df, (df$rrst_sensitivity), "Respiration Sensitivity") + 
  stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p1

# Filter the rows where rrst_sensitivity is greater than 8 and display pcode (visually detected as extreme)
filtered_pcodes <- df[df$rrst_sensitivity > 8, "pcode"]
print(filtered_pcodes) 
# P063

# Calculate mean and standard deviation of rrst_sensitivity
mean_rrst <- mean(df$rrst_sensitivity)
sd_rrst <- sd(df$rrst_sensitivity)
# Define the threshold for filtering (mean + 2.5 * SD)
threshold <- mean_rrst + 2.5 * sd_rrst # 7.07
# Filter the pcodes for rrst_sensitivity greater than the threshold
filtered_pcodes <- df[df$rrst_sensitivity > threshold, "pcode"]
# View the result
filtered_pcodes
# P063

# Testing the Assumptions in the main model (rrst sensitivity predicted by clinical variables) 
# model:
lmrrst <- lm(
  rrst_sensitivity ~ group + sex + bmi + psychotropic_medication + anx_dep_SUM + ctq_total + sdq,
  data = df)
# testing assumptions
plot(lmrrst, which=1) # testing the assumptions of Linearity and Homoscedasticity with residuals vs fitted plot: the line should more or less be straight: observation 56 is a clear outlier
plot(lmrrst, which=2) # testing the assumptions normality of residuals with  standardized quantiles: the data points should more or less on the line: observation 56 is a clear outlier (not as extreme but also noted: 81, 65)
plot(lmrrst, which=3) # testing the assumption of homoscedasticity with scale-location plot--> if there is an incline then we should consider log transformation: observation 56 is a clear outlier (not as extreme but also noted: 81, 65)
plot(lmrrst, which=5) # testing leverage and influence = when an outlier has a lot of leverage over the regression line (high leverage & large residual; these points will lie close to the right top or bottom corners): observation 56 is a clear outlier (not as extreme but also noted: 81, 6)
# observation 56 (consistent outlier) = P063

df_exclusion <- df[df$pcode != "63", ]

p1b <- plotBoxplotGroups(df_exclusion, (df_exclusion$rrst_sensitivity), "Respiration Sensitivity") + 
  stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
print(p1b)

p1b


# Summary of Change - depending on Exclusion of Outlier
summary(df$rrst_sensitivity)  # no sig difference between group (cut of 0.05)
summary(df_exclusion$rrst_sensitivity) # sig difference between group (cut of 0.05)

# for statistical reasons we EXCLUDE P063 from the dataset
df <- df[df$pcode != "63", ]


```

# 1) Having a look at the Data

```{r}
#| output: false
#| warning: FALSE
#| error: FALSE

# Normality of Data -------------------
shapiro.test(df$rrst_sensitivity) #  normally distributed
shapiro.test(df$metascore)# NOT normally distributed
shapiro.test(df$metascore[df$group == "1"]) # patients within themselves are NOT normally distributed
shapiro.test(df$metascore[df$group == "0"]) # controls within themselves are normally distributed

shapiro.test(df$age) # normally distributed

shapiro.test(df$bdi) #  NOT normally distributed : p < 0.05
shapiro.test(df$bdi[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$bdi[df$group == "0"]) # controls within themselves are NOT normally distributed

shapiro.test(df$stai_t) #  normally distributed 

shapiro.test(df$stai_s) #  NOT normally distributed 
shapiro.test(df$stai_s[df$group == "1"]) # patients within themselves are normally distributed
shapiro.test(df$stai_s[df$group == "0"]) # controls within themselves are NOT normally distributed : p < 0.05

shapiro.test(df$ctq_total) #  NOT normally distributed : p < 0.05
shapiro.test(df$ctq_total[df$group == "1"]) # patients within themselves are also NOT normally distributed
shapiro.test(df$ctq_total[df$group == "0"]) # controls within themselves are also NOT normally distributed

shapiro.test(df$sdq) #  NOT normally distributed : p < 0.05
shapiro.test(df$sdq[df$group == "1"]) # patients within themselves are NOT normally distributed
shapiro.test(df$sdq[df$group == "0"]) # controls within themselves are NOT normally distributed : p < 0.05

shapiro.test(df$maia_total) # normally distributed 
shapiro.test(df$traitPE_maiaRRST) # normally distributed with p < 0.05

shapiro.test(df$ias) # NOT normally distributed 
shapiro.test(df$traitPE_iasRRST) # normally distributed with p < 0.05

shapiro.test(df$bmi) # NOT normally distributed with p < 0.05
shapiro.test(df$bmi[df$group == "1"]) # within patients bmi is normally distributed 
shapiro.test(df$bmi[df$group == "0"]) # within control bmi is NOT normally distributed with p < 0.05


## 1.1 testing co-dependency of variables by creating a correlation matrix -----
# in order to run a correlation, all variables must be numeric (but we create new variables, so it wont mess with our variables that we defiend as factors)
corr_matrix <- cor(df[, c("age","bmi", "bdi", "stai_s", "stai_t", "ctq_total",
                          "ias", "maia_total", "sdq", "rrst_sensitivity", 
                          "traitPE_iasRRST", "traitPE_maiaRRST", "metascore")], use = "complete.obs")

# Set the cutoff for high correlations, that we then want to exclude
cutoff <- 0.7

# Find the indices of correlations that are greater than 0.8 and exclude self-correlations (diagonal)
high_corr <- which(abs(corr_matrix) > cutoff & abs(corr_matrix) < 1, arr.ind = TRUE)

# Display the pairs of variables with high correlations
high_corr_pairs <- data.frame(
  Var1 = rownames(corr_matrix)[high_corr[, 1]],
  Var2 = colnames(corr_matrix)[high_corr[, 2]],
  Correlation = corr_matrix[high_corr]
)

# View the pairs
print(high_corr_pairs) # stai and bdi are highly correlated, which we do accept though as this is a common clinical happening
cor.test(df$bdi, df$stai_t) # reason for using sum scores

### 1.2 Group Differences as Baseline of Variables of Interst ---------------------------------------------
# parametric t-test for NORMALLY distributed data
res<-t.test(df$rrst_sensitivity[df$group=="1"], df$rrst_sensitivity[df$group=="0"])
res # SIG difference between groups
res<-t.test(df$stai_t[df$group=="1"], df$stai_t[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-t.test(df$maia_total[df$group=="1"], df$maia_total[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-t.test(df$traitPE_iasRRST[df$group=="1"], df$traitPE_iasRRST[df$group=="0"])
res # no difference between groups with p < 0.05
res<-t.test(df$traitPE_maiaRRST[df$group=="1"], df$traitPE_maiaRRST[df$group=="0"])
res # no sig difference between groups

# non paramatric wilcox test for NOT normally distributed data 
res<-wilcox.test(df$metascore[df$group=="1"], df$metascore[df$group=="0"])
res # no sig difference between groups
res<-wilcox.test(df$ias[df$group=="1"], df$ias[df$group=="0"])
res # SIG difference between groups
res<-wilcox.test(df$bdi[df$group=="1"], df$bdi[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$stai_s[df$group=="1"], df$stai_s[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$ctq_total[df$group=="1"], df$ctq_total[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$sdq[df$group=="1"], df$sdq[df$group=="0"])
res # SIG difference between groups with p < 0.05
res<-wilcox.test(df$ias[df$group=="1"], df$ias[df$group=="0"])
res # no sig difference between groups
res<-wilcox.test(df$bmi[df$group=="1"], df$bmi[df$group=="0"])
res # no sig difference between groups

```

## Demographic Summary Table

```{r}
#| warning: FALSE
#| error: FALSE

# overview across group and sex distribution
tbl <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("female", "male"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND")))
tbl1<-table(tbl$group,tbl$sex)
tbl1

# overview for mean age across group
summary_stats <- tbl %>%
  group_by(group) %>%
  get_summary_stats(age, type = "full") # 'full' includes mean, SD, min, max, etc.
print(summary_stats)

res<-t.test(df$age[df$group == "0"], df$age[df$group == "1"]) # 
res # no sig difference between the groups in age


# SUMMARY TABLE DEMOGRAPHICS -----
df_tbl <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("male", "female"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND"))) %>%
  mutate(psychotropic_medication = factor(psychotropic_medication, levels = c("0", "1"), labels = c("no", "yes"))) 

library(gtsummary)
library(dplyr)

# Select relevant columns from df_tbl
Data.t <- select(df_tbl, c("group", "sex", "age", "psychotropic_medication", "bmi", "bdi", "stai_t", "ctq_total", "sdq"))

# Create the summary table
tbl1 <- Data.t %>%
    tbl_summary(
    by = group,
    missing = "no",
    statistic = list(
      age = "{mean} ({sd})",
      sex = "{n} ({p})",
      psychotropic_medication = "{n} ({p})",
      bmi = "{median} ({p25}, {p75})",
      bdi = "{median} ({p25}, {p75})",
      stai_t = "{mean} ({sd})",
      ctq_total = "{median} ({p25}, {p75})",
      sdq = "{median} ({p25}, {p75})"
    ),
    digits = list(age = 1, sex = 1, psychotropic_medication = 1, bmi = 1, bdi = 1, stai_t=1, ctq_total=1, sdq=1),
    label = list(age = "Age, mean (SD)",
                 sex = "Sex, count (%)",
                 psychotropic_medication= "Intake of psychotropic Medication, count (%)",
                 bmi = "Body Mass Index kg/mÂ², median (IQR)",
                 bdi = "Depression using BDI-II, median (IQR), ",
                 stai_t = "Trait Anxiety using STAI, median (IQR)",
                 ctq_total = "Childhood Trauma, using CTQ total, median (IQR)",
                 sdq = "Dissociation using SDQ-20, median (IQR)")
  ) %>%
  modify_header(list(label ~ "**Variable**")) %>%
  modify_caption("**Demographics Overview**") %>%
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Group**") %>%
  add_p( test = list(
        age ~ "t.test",            # t-test for numeric variables (even though NOT normally distributed; rather use wilcox and then the median instead of the mean??)
        bmi ~ "wilcox.test",            # t-test for bmi
        sex ~ "chisq.test",        # chi-square test for factor variables
        psychotropic_medication ~ "chisq.test",  # Fisher's exact test for small samples
        bdi ~ "wilcox.test",
        stai_t ~ "t.test",
        ctq_total = "wilcox.test",
        sdq="wilcox.test"
      )) %>% #add p-value# add p-value (in case different variable should be tested differently, create a list and specify like that: add_p(test = list(age = "t.test", bmi = "wilcox.test"))
  add_overall(last = FALSE)

# Display the table
tbl1

```

## FND Summary Table

```{r}
#| warning: FALSE
#| error: FALSE
# 1.4 SUMMARY TABLE for FND symptoms -----
# create variable of duation of months
df_FND <- df_FND %>%
  mutate(duration_months = interval(date_symptom_onset, date) %/% months(1)) # calculate month duration

as.numeric(df_FND$duration_months)

# Select only the defined variables
df_tbl <- df_FND %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("female", "male"))) 

library(gtsummary)
library(dplyr)

# Select relevant columns from df_tbl
Data.t <- select(df_tbl, c("sex", "duration_months", "fds", "motor", "weakness", "sensory", "pppd", "cognitive"))

# Create the summary table
tbl <- Data.t %>%
  tbl_summary(
    by = sex,
    missing = "no",
    statistic = list(
      duration_months = "{mean} ({sd})",
      fds = "{n} ({p})",
      motor = "{n} ({p})",
      weakness = "{n} ({p})",
      sensory = "{n} ({p})",
      pppd = "{n} ({p})",
      cognitive = "{n} ({p})"
      ),
    digits = list(duration_months = 1,fds = 1,motor = 1,weakness = 1,sensory = 1,pppd = 1,cognitive = 1),
    label = list(
      sex = "Sex",
      duration_months = "Symptom Duration [in months]",
      fds = "Functional Dissociative Seizures [yes]",
      motor = "motor + symptoms [yes]",
      weakness = "motor - symptoms [yes]",
      sensory = "sensory symptoms [yes]",
      pppd = "dizziness (PPPD) [yes]",
      cognitive = "cognitive symptoms [yes]"
    )
  ) %>%
  modify_header(list(label ~ "**Variable**")) %>%
  modify_caption("**Clinical Characteristics**") %>%
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Group**") %>%
  add_overall(last = FALSE)

# Print the summary table
tbl
```

# 2) Group Differences - Baseline

Here we visualize the different distribution per group across all variables

```{r}
#| warning: FALSE
#| error: FALSE
df$group <- as.factor(df$group)

plotViolinGroups <- function(df, var , tit ){ 
  plot <-ggplot(df, aes(x=group, y=var, fill=group)) + # this is just the ground structure. We have group on x axis, our variable score on y, and we want to seperate the groups. 
    geom_violin(show.legend = FALSE, width = 0.7, trim = FALSE, alpha = 0.8)+ # here we say what kind of plot we want to make; namely violin to show the distrubition of the original data (width to make it less wide and thus prettier) 
    stat_summary(show.legend = FALSE, fun = median, geom = "point", color = "black", size = 2) +  # Add median point without legend
    labs(y = "Score") + # These are just the different titles
    theme_classic()+ # here we have the background, simple white :)
    scale_fill_manual(values = c("#868686FF", "#BB4038"))+ # google HEX codes and find your own colours. 
    scale_x_discrete(labels=c("Controls", "Patients"))+  # these are our labels for the x axis
    guides(fill=guide_legend(title="Timepoint"))+ # and a title for our legend
    ggtitle(tit) +
    xlab("")
  
  return(plot)
}

p1 <- plotViolinGroups(df,df$bdi,"BDI - Depression")+ ggpubr::stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p1


p2 <- plotViolinGroups(df,df$stai_s,"STAI - State Anxiety")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p3 <- plotViolinGroups(df,df$stai_t,"STAI - Trait Anxiety")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
gridExtra::grid.arrange(p2, p3, ncol = 2)


p4 <- plotViolinGroups(df,df$ctq_total,"CTQ - Childhood Trauma")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p4

p5 <- plotViolinGroups(df,df$sdq,"SDQ-20 - Dissociation")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p5


p6 <- plotViolinGroups(df,df$maia_total,"MAIA - Interoceptive Awareness")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p6


p7 <- plotViolinGroups(df,df$ias,"IAS - Interoceptive Accuracy")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
p7


p8 <- plotViolinGroups(df,df$traitPE_maiaRRST,"TraitPE MAIA-RRST")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p9 <- plotViolinGroups(df,df$traitPE_iasRRST,"TraitPE IAS-RRST")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
gridExtra::grid.arrange(p8, p9, ncol = 2)


p10 <- plotViolinGroups(df,df$rrst_sensitivity,"Respiratory Sensitivity")+ stat_compare_means(method = "t.test", paired = FALSE, label.x = 1.3)
p11 <- plotViolinGroups(df,df$metascore,"Respiratory Metacognition")+ stat_compare_means(method = "wilcox.test", paired = FALSE, label.x = 1.3)
gridExtra::grid.arrange(p10, p11, ncol = 2)


# Table for dependent Variables: group differences
df_tbl <- df %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND"))) 
  
Data.t <- select(df_tbl, c("group", "maia_total","traitPE_maiaRRST", "ias", "traitPE_iasRRST", "rrst_sensitivity" , "metascore"))
library(gtsummary)
tbl2 <- Data.t %>%
  tbl_summary(
    by = group,
    missing = "no",
    statistic = list(
      maia_total = "{mean} ({sd})",
      traitPE_maiaRRST = "{mean} ({sd})",
      ias = "{median} ({IQR})",
      traitPE_iasRRST = "{mean} ({sd})",
      rrst_sensitivity = "{mean} ({sd})",
      metascore = "{median} ({IQR})"
    ),
    digits = list(maia_total = 1, traitPE_maiaRRST = 1, ias = 1, traitPE_iasRRST = 1, 
                  rrst_sensitivity = 2, metascore = 2),
    label = list(maia_total= "Interoceptive Awareness Self-Report - MAIA, Mean, (SD)",
                 traitPE_maiaRRST= "Respiratory Trait-Prediction-Error, MAIA-RRST, Mean (SD)",
                 ias= "Interoceptive Accuracy Self-Report - IAS, Median (IQR)",
                 traitPE_iasRRST = "Respiratory Trait-Prediction-Error, IAS-RRST, Mean (SD)",
                 rrst_sensitivity= "Respiratory Sensitivity - RRST, Mean (SD)",
                 metascore= "Respiratory Metacognition - AUC, Median (IQR)"
                 )
  ) %>%
  modify_header(list(label ~ "**Variable**")) %>%
  modify_caption("**Interoception Overview**") %>%
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Group**") %>%
  add_p(
    test = list(
      maia_total = "t.test",            
      traitPE_maiaRRST = "t.test",            
      ias = "wilcox.test",        
      traitPE_iasRRST = "t.test", 
      rrst_sensitivity = "t.test",
      metascore = "wilcox.test")
    ) %>%
    add_overall(last = FALSE)
tbl2
```

# 3) Interoception

Here we model interoceptive variables using group and clinical predictors

```{r}
#| warning: FALSE
#| error: FALSE

# predicting group with interoceptive variables and most important covariates
glm <- glm(formula = group ~  sex + rrst_sensitivity  + metascore + maia_total + ias + anx_dep_SUM + ctq_total + sdq,
            data = df,
            family = binomial) # as group has two levels
summary(glm) # SDQ predict group

# testing for best model fit with covariates at hand
lmrrst1 <- lm(rrst_sensitivity ~ group + anx_dep_SUM + psychotropic_medication, data = df)
lmrrst2 <- lm(rrst_sensitivity ~ group + anx_dep_SUM + ctq_total + sdq, data = df)
lmrrst3 <- lm(rrst_sensitivity ~ group + sex + psychotropic_medication + anx_dep_SUM + ctq_total + sdq, data = df)
lmrrst4 <- lm(rrst_sensitivity ~ group + bmi + psychotropic_medication + anx_dep_SUM + ctq_total + sdq, data = df)
lmrrst5 <- lm(rrst_sensitivity ~ group + sex + bmi + psychotropic_medication + anx_dep_SUM + ctq_total, data = df)
lmrrst6 <- lm(rrst_sensitivity ~ group + sex + bmi + psychotropic_medication + anx_dep_SUM + ctq_total + sdq, data = df)
lmrrst7 <- lm(rrst_sensitivity ~ group + bmi + psychotropic_medication + anx_dep_SUM + ctq_total + sdq, data = df)
lmrrst8 <- lm(rrst_sensitivity ~ group + sex + age + bmi + psychotropic_medication + anx_dep_SUM + ctq_total + sdq, data = df)

AIC(lmrrst1, lmrrst2, lmrrst3, lmrrst4, lmrrst5, lmrrst6, lmrrst7, lmrrst8) # model 3, 6 and 8 are low
anova(lmrrst3, lmrrst6, lmrrst8) # testing whether it adds sig value if we change from 3 to 6 to 8; no--> model 3 chosen

# predciting rrst sensitvity with covariates
lm<-lm(rrst_sensitivity ~ group + sex + psychotropic_medication + anx_dep_SUM + ctq_total + sdq,
  data = df)
summary(lm) # SEX, MEDICATION, CTQ and SDQ sig associated with RRST-sensitivity

# RRST sensitivity and separate CTQ subscores
lmrrst <- lm(
  rrst_sensitivity ~ group + ctq_physab + ctq_emoab + ctq_sexab + ctq_emoneg + ctq_physneg,
  data = df)
summary(lmrrst)  # no subscale in intself associated with RRST


# predciting  rrst metascore with covariates
lm<-lm(metascore ~ group + sex + psychotropic_medication + anx_dep_SUM + ctq_total + sdq,
  data = df)
summary(lm) #  SDQ and CTQ sig associated with METASCORE

# RRST metascore and separate CTQ subscores
lm <- lm(
  metascore ~ group + ctq_physab + ctq_emoab + ctq_sexab + ctq_emoneg + ctq_physneg,
  data = df)
summary(lm) # no subcascale in itself associated with RRST


# predciting  traitPE uing RRST and MAIA with covariates
lm<-lm(traitPE_maiaRRST ~ group + sex + psychotropic_medication + anx_dep_SUM + ctq_total + sdq,
  data = df)
summary(lm) #  SEX, MEDICATION and ANX-DEP sum score sig associated with traitPE-maia

# predciting  traitPE uing RRST and MAIA with covariates
lm<-lm(traitPE_iasRRST ~ group + sex + psychotropic_medication + anx_dep_SUM + ctq_total + sdq,
  data = df)
summary(lm) #  MEDICATION sig associated with traitPE-ias

```

# 4) Symptom Severity (FND only)

```{r}
# Compute the correlation matrix with variables of symptom severity to see whether they correlate
# Select the desired variables
severity_variables <- df_FND[, c("sfmdrs", "cgi", "sdq", "sum_positive_signs", "sum_severity")]

# Compute the correlation matrix with rcorr
correlation_results <- Hmisc::rcorr(as.matrix(severity_variables))

# Extract correlation coefficients
cor_matrix <- correlation_results$r

# Extract p-values
p_matrix <- correlation_results$P

# Print results
cor_matrix
p_matrix

# SIG correlations of different symptom severity scores
### CGI & SFMDRS corr: r= 0.5841928 , p=3.136863e-05
### CGI & SUM_POS corr: r= 0.5531214  2, p=9.864238e-05
### SDQ & SUM_POS corr: r=0.4738588, p=1.157504e-03
### CGI & SUM_SEVERITY corr: r=0.43742577 , p=0.002985648

#SFMDRS
sfmdrslm <- lm(formula = sfmdrs ~  rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore,
               data = df_FND) 
summary(sfmdrslm)   # no sig association

#CGI
cgilm <- lm(formula = cgi ~ rrst_sensitivity + traitPE_iasRRST + traitPE_maiaRRST + metascore,
            data = df_FND) 
summary(cgilm) # no sig assocaition

#Sum score pos signs  (pos signs like wekaness in deltoid/stenocleido etc, co-contractions, give way weakness, hoover, hyposensitivity)
sum_pos_lm <- lm(formula = sum_positive_signs ~  rrst_sensitivity + metascore + ias + maia_total,
                 data = df_FND) 
summary(sum_pos_lm)   # p=0.0556 for rrst_sensitivity

#Sum score severity (motor weakness and seizure frequency)
sum_pos_lm <- lm(formula = sum_severity ~  rrst_sensitivity + metascore + ias + maia_total,
                 data = df_FND) 
summary(sum_pos_lm)  # p= 0.069 for metascore
```

# 5) Visualization of sig association

```{r}
df_plot <- df %>%
  mutate(sex = factor(sex, levels = c("1", "2"), labels = c("female", "male"))) %>%
  mutate(group = factor(group, levels = c("0", "1"), labels = c("HC", "FND")))

# SDQ-RRST_sensitivity
RRST_sdq <- ggplot(df_plot, aes(x = sdq, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Dissociative Score (SDQ-20)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines

RRST_sdq

# CTQ-RRST_sensitivity
RRST_ctq <- ggplot(df_plot, aes(x = ctq_total, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Experience of Childhood Trauma (CTQ)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
RRST_ctq

# VISUALIZATION PER CTQ SUBSCORE that was foudn sig between groups
# Physical_Abuse-RRST_sensitivity
RRST_physab <- ggplot(df_plot, aes(x = ctq_physab, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Physical Abuse in Childhood (CTQ subscale)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
RRST_physab

# Emotional_Neglect-RRST_sensitivity
RRST_emoneg <- ggplot(df_plot, aes(x = ctq_emoneg, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Emotional Neglegt in Childhood (CTQ subscale)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
RRST_emoneg

# Emotional_Abuse-RRST_sensitivity
RRST_emoab <- ggplot(df_plot, aes(x = ctq_emoab, y = rrst_sensitivity, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Emotional Abuse in Childhood (CTQ subscale)", 
       y = "Respiratory Sensitivity (RRST)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
RRST_emoab

# Sex-RRST_sensitivity
RRST_sex <- ggplot(df_plot, aes(x = as.factor(sex), y = rrst_sensitivity, fill = as.factor(group))) +
  geom_boxplot() +  # Create the box plot
  geom_jitter(position = position_jitterdodge(jitter.width = 0.5, dodge.width = 0.75), color = "black", size = 1.5, alpha = 0.6) +  # Add jittered points in black
  labs(x = "Sex", 
       y = "TraitPE (HBT-IAS)", 
       title = "Trait-Prediction-Error HBT-IAS (FND vs HC)",
       fill = "Group") +  # Label for the legend
  theme_minimal() +
  scale_fill_manual(values = c("HC" = "#868686FF", "FND" = "#E95248"))+ #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
RRST_sex

# SDQ-metascore
meta_sdq <- ggplot(df_plot, aes(x = sdq, y = metascore, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Dissociative Score (SDQ-20)", 
       y = "Respiratory Metacognition (AUC)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
meta_sdq

# CTQ-metascore
meta_ctq <- ggplot(df_plot, aes(x = ctq_total, y = metascore, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Experience of Childhood Trauma (CTQ)", 
       y = "Respiratory Metacognition (AUC)", 
       title = "Respiratory Interoception (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248"))+ #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
meta_ctq

# traitPEmaia-Anx-Dep
traitPEmaia_anxdep <- ggplot(df_plot, aes(x = anx_dep_SUM, y = traitPE_maiaRRST, color = as.factor(group))) +
  geom_point() +  # Scatterplot for both groups
  geom_smooth(method = "lm", se = TRUE) +  # Add regression lines and SE
  labs(x = "Anxiety & Depression Sum Score (STAI-T & BDI-II)", 
       y = "Trait-PredictionError (RRST-MAIA)", 
       title = "Interoceptive Trait-Prediction Error (FND vs HC)",
       color = "Group") +  # Label for the legend
  theme_minimal() +
  scale_color_manual(values = c("HC" = "#868686FF", "FND" = "#E95248")) + #custom colors
  theme(panel.grid = element_blank())  # Remove grid lines
traitPEmaia_anxdep
```

# Take Home Message

After excluding one outlier (FND patient \> 2.5 SD from mean, and outlier in terms of value, but also in testing the model fit in terms of normality/homoscedasticity of resiudaly) we have N=91.

Baseline: FND patients have higher intake of psychotropic medication (p<0.001), higher BMI (p=0.019), higher Depression (p=4.2e-09) and Anxiety Scores (State: p=4.9e-06, Trait: p=4.1e-04), higher Experience of Childhood Trauma (p=0.0014) and Dissociation (p=1.4e-10) compared to controls.

Interoception: 
FND patients show to have lower interoceptive sensibility, juding from MAIA questionnaire (p=4.4e-04) and IAS (p=0.018) compared to controls The traitPE of RRST and these two questionnaires did not differ sig between the groups.

FND patients have lower interoceptive sensitivity (p=0.032), but no difference in metacognition (p=0.9), compared to controls.

SDQ is associated with GROUP, when controlling for clinical and interoceptive variables (p=0.00147).

Clinical Covariates to include in the model were: Group, Sex, Intake of psychotropic_medication (yes/no), Anxiety/Depression Sum Score, CTQ total score, SDQ-20 score:
Male sex (t=2.456, p=0.01616), no intake of psychotropic medication (-2.667, p=0.00921), experience of more childhood trauma (t=2.277, p=0.02541) and lower dissociation (t=-2.894, p=0.00487) is associated with higher RRST sensitivity, when controlling for all other variables. 
Lower dissociation (t=-2.747, p=0.00739) and with weak evidence also Childhood Trauma (t=1.934, p=0.05651) were associated with higher metascores, when controlling for all other variables. 
NOTE: the CTQ subscores would not show visually / nor statistically a specific contirbution to the RRST sensitivity or metacognition. 
The intake of psychotropic medication (t=2.799, p=0.00638) and lower scores in Anxiety/Depression (t=-4.112, p=9.28e-05), and with weak evidence also female sex (t=-1.920, p=0.05831) are associated with higher TraitPrediction Error using RRST-sensitivity and the MAIA questionnaire, when controlling all other variables. 
The intake of psychotropic medication (t=2.113, p=0.0377) is associated with higher TraitPrediction Error using RRST-sensitivity and the IAS questionnaire, when controlling all other variables.

Symptom Severity There is weak evidence, that lower RRST-sensitivity is associated with more positive signs in FND (t=-1.973, p=0.0556).

From the visualization it is apparent that the RRST-Sensitivity & Metacognition in Controls is not dependent on dissociation scores, while for patients they are lower for higher dissociation scores (but note also the larger spread for patients only). While there is no linear association for CTQ and Metacognition, it iseems that for FND only, the more experiences of Childhood Trauma, the higher the metacognitive score. Finally, the Trait-Prediction Error (RRST-MAIA) shows that controls seem to overestimate themselve sin terms of interoceptive performance when scoring low on Anxiety&Depression, while they start to underestimate their performance with higher Anxiety&Depression scores. For FND, this trend is definitely smaller; independent of affective smyptoms, FND patients seem to be closer to a zero in Trait-Prediction Error (using RRST performance and MAIA self report).
